<div class="ui-fluid">
  <app-task-container>
    <div taskBody>
      <div class="comunicacion-detalles">
        <p-tabView [activeIndex]="tabIndex" [lazy]="true" (onChange)="onTabChange($event)">
          <p-tabPanel header="Datos generales" leftIcon="ui-icon-assignment">
            <app-detalles-datos-generales [comunicacion]="comunicacion"
                                          [constantesList]="constantes"></app-detalles-datos-generales>
          </p-tabPanel>

          <p-tabPanel header="Remitente / Destinatario" leftIcon="ui-icon-assignment">
            <app-detalles-datos-remitente [remitente]="remitente$ | async"
                                          [contactos]="contactos$ | async"
                                          [constantesList]="constantes"></app-detalles-datos-remitente>

            <app-detalles-datos-destinatario [destinatarios]="destinatarios$ | async"
                                             [constantesList]="constantes"></app-detalles-datos-destinatario>
          </p-tabPanel>
          <p-tabPanel header="Vista previa del documento" leftIcon="ui-icon-assignment" no-padding>
            <div style="overflow-y: scroll;max-height: 100%" *ngIf="docSrc">
              <pdf-viewer [src]="docSrc" [show-all]="true" [zoom]="1.5"></pdf-viewer>
            </div>
          </p-tabPanel>
          <p-tabPanel header="Observaciones" leftIcon="ui-icon-assignment">
            <app-popup-agregar-observaciones #popupAgregarObservaciones></app-popup-agregar-observaciones>
          </p-tabPanel>
          <p-tabPanel header="Gestionar" leftIcon="ui-icon-assignment">
            <app-gestionar-comunicacion [remitente]="remitente$ | async" [task]="task" (onRedireccionarTriggered)="redireccionar($event)"></app-gestionar-comunicacion>
          </p-tabPanel>
        </p-tabView>
      </div>
    </div>
  </app-task-container>
</div>

<p-dialog [visible]="redireccionFallida$ | async" modal="modal" [responsive]="true"
          [contentStyle]="{'overflow':'visible'}"
          (onHide)="cleanRedirecionFallida()" [width]="800">
  <p-header>
    Devoluciones / Redirección - Fallida
  </p-header>

  <h3>Número máximo de redirecciones alcanzado</h3>
  <p>Si desea forzar la redirección, (click) en continuar.</p>

  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button pButton type="button" class="ui-button-danger"
              label="Cerrar" (click)="cleanRedirecionFallida()"></button>

      <button pButton type="button" class="ui-button-danger"
              label="Continuar" (click)="forceRedireccion()"></button>
    </div>

  </p-footer>
</p-dialog>
